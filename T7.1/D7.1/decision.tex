
% (mj) a macro for clearly marking decisions as such.
\newcounter{decision}
\newcommand{\decision}[1]{
\begin{center}
\begin{tabular}{ p{13cm} }
\stepcounter{decision}\textbf{Decision~\arabic{decision}}  \\
\hline
\multicolumn{1}{|p{13cm}|}{#1} \\
\hline
\end{tabular}
\end{center}
}


\chapter{Decisions}
\label{sec:decision}

As anticipated, there is not one single tool choice done by WP7 partners. This has the advantage of reducing risk (if a tool does not work out), but the disadvantage of potentially wasting resources and being unfocused.  The objective of this chapter is to summarize results of analyses (see Section~\ref{sec:swot}) and the decisions and to propose a work plan that leverages the advantage of having multiple tools, while reducing the risks resulting from this. (see Section~\ref{sec:dec}.  However, the choice of the tool platform was easy and unanimous.

\section{SWOT Analysis}
\label{sec:swot}

By looking a the strengths, weaknesses, opportunities and threats (SWOT) of each toolchain, we will get a qualitative impression on what we could gain with each solution, and what the risks are.

\subsection{SCADE SWOT Analysis}

\emph{Scade delivers all the required features, but is closed source.}

\subsubsection{Strengths (SCADE)}

The biggest strength of SCADE by far is that it works ``out of the box'', barely any tailoring is required.  SCADE has been developed for systems engineering, and this is exactly the right field of application.  Further, a Papyrus integration is already available, so little work has to be done here.  Another strength is the fact that some of the secondary tool activities are covered by SCADE as well.

\subsubsection{Weaknesses (SCADE)}

The biggest weakness of SCADE is a show stopper: SCADE is not open source, and as no open source alternative exists, openETCS would miss its Open Proofs objective.

\subsubsection{Opportunities (SCADE)}

Using SCADE would doubtless increase the chances of success of the modeling activities.  Thus, SCADE is an excellent backup plan.  By nominating SCADE as a backup, we would ensure damage control: A successful model, even if not created with open tools is preferable to no model at all.

There is another opportunity: by dangling the chance to adapt SCADE and potentially opening a large market segment, Esterel (manufacturer of SCADE) may decide to open SCADE --- at least enough for our purposes.

\subsubsection{Threats (SCADE)}

There is the real threat that Esterel is encouraging us to adapt SCADE under the premise of opening parts of SCADE to be compliant with Open Proofs.  If such discussions would breakdown, after modeling has already started, we'd have a problem.

\subsection{ERTMS Formal Specs SWOT Analysis}

\emph{A significant portion of the ETCS specification has already been modelled with EFS, albeit with a semi-formal language.}

\subsubsection{Strengths (EFS)}

EFS is open source.  Even better, a significant portion of the ETCS specification has already been modeled using the tool.  The creator of the tool (ERTMS Formal Specs) is available in the project and has project resources for WP7, which should result in fast turnaround during development.

It has already been proven that all features of the ETCS specification can be modeled.

EFS has been developed as a commercial tool and is based on real-world needs in the rail industry.

\subsubsection{Weaknesses (EFS)}

EFS has originally been written using the .NET platform.  Even though a prototype based on Eclipse EMF exists, a significant amount of work is required to make it truly user friendly.  However, it should be possible to work during a transition phase with the old tool.

As the notation of EFS is more of a domain-specific language (DSL), a debate has been going on whether EFS is ``formal enough''.  This is not a big problem, as the model could be extended with fully-formal models in relevant places.  A bigger question is how the integration of the various models would be realized.  There won't be a clear answer on that, until we try it out.

Last, the ``lower part'' of the toolchain is citing technologies that need a significant investment of energy before they can be used.  For instance, Xtend is a programming language, which is not doing anything domain-specific.

\subsubsection{Opportunities (EFS)}

The main opportunity is to safe time and resources, as a significant portion of the ETCS specification has already been modeled.  Another is the certainty that a commercial partner will be engaged in the ongoing activities, even after the end of openETCS.

\subsubsection{Threats (EFS)}

The continuation of the toolchain, as shown in Figure~\ref{fig:ERTMSFormalSpecsProposal}, leave some questions open.  Compare that to the much more concise description of the B-approach in Figure~\ref{fig:classical-b-toolchain}.  Due to the ambiguity there is a significant risk that the model integration won't work as shown.

\subsection{B SWOT Analysis}

\emph{B has industry strength and the ecosystem includes open tools, but not all aspects of the ETCS may be representable, and the learning curve is steep.}

\subsubsection{Strengths (B)}

B is proven in the rail industry, where it has been deployed successfully.  There is also a strong body of academic research that can be taken advantage of.

There is a decent amount of tooling already available, both open source and commercial.  However, an almost complete open toolchain has been suggested in Table~\ref{tab:classical-b-tools}, with the Atelier B type checker being the only exception (see Weaknesses below).

There is B-related expertise in the consortium, ensuring that questions can be answered and that there is a commercial incentive.

\subsubsection{Weaknesses (B)}

Atelier B is not Eclipse-based, and Appendix~\ref{sec:sysML-B} points out this shortcoming.  On the positive side, it is available on all relevant platforms (Windows, Mac, Linux).

There is also the Atelier B type checker, which is not open source.  Finding an open replacement for this relatively small component would be one mandatory activity.

While B is well-suited for modeling state-based systems, it is not clear how continuous modeling (e.g. breaking curves) would be realized.


\subsubsection{Opportunities (B)}

B could be the sweet spot between using a commercially proven approach (like SCADE), while still residing in the open source realm (like TOPCASED).  And as there are more options available, both open and closed, the risk is lower.

\subsubsection{Threats (B)}

Acceptance may be the biggest problem, as B is a ``hard core'' formal notation, which is considered hard to read.  We must be prepared to train the users and ensure that they accept it beforehand.

\section{Decisions}
\label{sec:dec}

In the following, we will document a number of decisions that follow from our analysis and that will guide the activities until the end of 2013.

The tools covered here must allow working with the four models shown in Figure~\ref{fig:main_process}.


\subsection{Decision on the tool platform}
\label{sec:decision_platform}

\decision{By vote in Paris on July 4th, 2013, all the partners agree on the use of \textbf{Eclipse} as tool platform. }

 Which version of Eclipse will be used is up to the implementing team (T7.3).  The last release is Kepler 4.3, launched the 26 of June 2013.


\subsection{Papyrus/SysML}

\decision{By vote in Paris on July 4th, 2013, all the partners agree on the use Papyrus/SysML to cover the highest level of the OpenETCS V-cycle.}

All proposed toolchains will use SysML with Papyrus.  To keep things as flexible as possible, it would be desirable to use SysML in exactly the same way for all approaches.  The B team suggested to create modeling guidelines, and to build a validator for validating the SysML model accordingly.

\decision{All three teams will work together to create modeling guidelines that will apply to all three toolchains.  If this turns out not to be possible, they should create a superset guideline, with extensions for the three approaches.}

\subsection{SCADE}

The analysis shows that we have two promising open proposals (EFS, B), and a third non-open proposal, that is extremely powerful (SCADE).  Considering the constraints of the project, it is clear that SCADE should only be employed if everything else fails.  It is a ``Plan B'' that we should be grateful for, as it may allow us to make openETCS at least a partial success, in case of a larger tool crisis (of whatever nature).  Therefore, we decide:

\decision{The SCADE toolchain will be the ``Plan B'' toolchain, to be employed if ``all else fails''.}

\decision{Therefore, activities on the SCADE toolchain will be suspended for the time being.}

If we are in a real crisis (this will hopefully never happen), we'll have to put relatively little effort into migrating whatever has been done to the SCADE toolchain.  This will be particularly true if we carefully define the scope of the Papyrus component.


\subsection{Aligning EFS and B toolchains}

For better or worse, there is no clear winner between the EFS and B toolchains.  We will know more when the rubber hits the road --- when we start modeling.  Therefore, modeling activities should start as soon as possible with a well-defined case study.

\decision{As the toolchains are being built, modeling will start immediately on a small, well-defined case study, which will represent a subset of the spec.  The model will cover the tool from top to bottom, thereby demonstrating that the toolchain actually works as advertised.}

It is conceivable to continue with the radio subsystem that has been used for the benchmarking, but the modeling expert may suggest a better case study.

It is quite conceivable that no clear winner emerges, but that individual components show unexpected strengths or weaknesses.  Therefore, the toolchain must first define clear interfaces, similar to what the B team already hinted at in Figures~\ref{fig:classical-b-toolchain} and \ref{fig:classical-b-transformation-alternatives}.  Again, there is no reason not to look for similarities between the two open toolchains and to align the interfaces, wherever it makes sense.  For instance, if the Polarsys tools are not performing as expected, they may be replaceable by B tools.  Therefore:

\decision{All toolchains shall clarify their architecture, keep it as modular as possible and align interfaces between them, wherever it makes sense.}

\subsection{Intermediate solution and migration path}

\begin{comment}
Issue \#79 openned by Uwe Steinke to discuss here :


WP 7 is in the obligation to provide and supply all other WPs with an intermediate tool chain until the preferred tool chain becomes operabel. The reason is to enable the other WPs to work productivly.
Additionally, there must be a migration path between the intermediate tool chain and the preferred one, that assures that the results produced with the intermediate tools can be transferred automatically.

The intermediate path has to be specified in this document.

\end{comment}

\begin{comment}
Issue \#99 openned by Christophe Ponsard :


I like the point about interfaces enabling to "cross-over" between toolchains

In figure 2 we could highlight them more explicitly, obviously after semi-formal (common papyrus) but also at the interface with code generation.

(maybe the figure is not suited to show them all)

\end{comment}

\section{Recommendations for WP3 Modeling}

We can make decisions for WP7, but can only articulate recommendations for WP3.  Making these will hopefully clarify the intentions behind our decisions even more.

Three toolchains have been proposed, all with their various advantages and drawbacks. The weakest candidate is B, as this option cannot be used any time soon in order to meet the openETCS project schedule, and because there is no clear partner backing it with resources.  This toolchain candidate is therefore ruled out for now, unless a B-based  toolchain becomes available, to be used down to software generation and verification.  This would require a partner with WP7/WP3 resources to step up and take ownership.

This leaves two toolchains, Scade and EFS.  We recommend WP3 to pursue both, with two independent teams:

\begin{description}

\item[Team SCADE.] This team will first structure the system by applying structural analysis and functional decomposition using the Papyrus functionality of the SCADE system level.  Later it will generate an executable functional model and then a real-time model, finally generating executable software for either an PC based simulation system or for embedded control units providing the proposed non-vital OBU reference.

\item[Team EFS.] This team will develop a mapping from the EFS model to SysML, providing a visual representation of the EFS model with Papyrus. In parallel, they will complete the already started formalization work of the SRS and related SubSets by using the EFS tool.  Last, and also in parallel, they will develop a transformation of the EFS model to code, thereby demonstrating that a code generator is feasible.

\end{description}

In order to minimize the risk that the teams deviate too much from each other, we recommend nominating an expert or a team to synchronize their activities.  WP3 must decide whether they want the teams to model the same artifacts, or prefer complimentary artifacts.  The former approach allows the comparison of the models, or their use for a basic verification cycle.  The latter approach makes more efficient use of resources. Further, such an expert should also ensure that the two toolchains / models have as many common interfaces as possible (e.g. both should use the same subset of SysML features).

Potential shortcomings of either approach can be addressed and used for further improvement or influence the development work to be accomplished in WP7, for instance by leveraging the B approach after all.  Since no further delay for the modeling work needs to be taken into account, that approach allows to start right away.

All parties who want to work in the modeling phase have to decide either to acquire licenses for SCADE in order to create models and software or work with EFS, which comes free of charge.
For the first modeling step with SCADE, which is functional decomposition and interface description, Papyrus can be used alternatively to SCADE Systems. A users guide has to be generated to make sure that artifacts are interchangeable between SCADE System and Papyrus. 

\section{Conclusion}

While there was some discontent in the team of not having one single solution to move forward with, we simply have to turn this to our advantage.  Having options helps us reduce risk, and by aligning the activities, we prevent our effort from dissipating.  We believe that the documented decisions will act as high-level guidelines for achieving this goal.

The previous section \ref{sec:dec} gives the actual decisions taken by WP7 and project partners.
However, decisions or points of view have been given by the leaders of other workpackages and are summed up in the sequel.

\subsection{WP3 point of view}

\paragraph{WP3 leader point of view (issue \#109):}
\emph{Indeed, ALSTOM, as modeling WP leader, needs now to organize WP3 kick-off meeting and ressources working within a clear framework and objective. With D7.1 conclusion as it is now, WP3 ressources are working now in the tools they want to work on without clear strategy nore objective.
Therefore, ALSTOM proposed following D7.1 conclusions to be :
1 - Despite the fact it is not fully open tools, "SYSML / SCADE" is the baseline primary tools chain to be used for any modeling activity within the frame of the OpenETCS project unless other agreement and.or decision not late than January 2014
2 - In order to allow availability of another complete full OpenETCS Tools chain, complementary analysis and work will be carried out on the 2 other options "SYSML/EFS/Eclpse Polarys" and SYSML / Classical B" for final decision on "OpenETCS" Tools chain not late than January 2014
Such conclusion is likely to avoid dispersion of WP3 ressources that lead to impossibility to manage modeling WP while keeping intact the possibility for the other candidate tools chain to be adopted if confirmed as complete and usable as the only today's available fitted for purpose "SYSML / SCADE" solution.}


\subsection{WP4 point of view}

Some decisions have been made by the WP4 partners regarding VnV and safety activities. these decision have been announced during the decision in Paris on July 4th, 2013:

\decision{WP4 is going to consider the artifacts of "SysML+ Scade" toolchain for the first round of verification and validation launched in July 2013.}

\decision{For the following rounds, starting in February 2014, WP4 will adapt the verification and validation activities to the models and code provides by WP3.}



\chapter{SysML and ClassicalB}
\label{sec:sysML-B}

This section describes the approach of combining SysML modeling with
the B Method. The technical realization is shown in Figure
\ref{fig:classical-b-toolchain}. Modeling starts in SysML based on the
tool Papyrus. At the current stage of the project, it is undefined
which SysML elements and diagrams will be used. This must be well
defined to ensure that a transformation from SysML to Classical B is
semantically correct. To ensure this, the approach suggest the use of
the \emph{Object Constraint Language (OCL)} or the \emph{Eclipse
  Validation Framework} for validating the SysML model according to
defined modeling guidelines. Such guidelines may restrict the usage of
certain modeling elements and may enforce certain naming conventions.

The validated SysML model will be transformed to a Classical B model
with a model to text transformation language (e.g. Xtend2). That B
model is considered as read-only and is only allowed to be further
refined. From that point, the existing Atelier B toolchain will be
used for refining the model until reaching the implementation
model. Provers support the V\&V activities and the open source code
generator c4g is capable of generating C code.

The proposed toolchain is intended to be a first version. The yellow
boxes in Figure \ref{fig:classical-b-toolchain} indicate non existing
software artifacts that have to be developed within the openETCS
project. Furthermore, it is desirable to move parts from the Atelier B
tool into Eclipse. 

\begin{figure}
  \centering
  \includegraphics[width=6in]{images/classical_b_toolchain.pdf}
  \caption{Technical overview of the Papyrus and Classical-B toolchain}
  \label{fig:classical-b-toolchain}
\end{figure}


In Table \ref{tab:classical-b-tools} the list of tools used in the
proposed toolchain is given.

\begin{center}
\begin{table}
  \begin{tabular}{ l | l | l }
    Tool                               & License & Link \\ 
    \hline \hline
    Bart (B Automatic Refinement Tool) & GPL & \url{http://sf.net/projects/bartrefiner/} \\ \hline
    Atelier B GUI                      & GPL & \url{http://sf.net/projects/atelierbgui/} \\ \hline
    Bcomp (B Compiler)                 & GPL & \url{http://sf.net/projects/bcomp/} \\ \hline
    C4b (C Code Generator)             & GPL & \url{http://sf.net/projects/c4b/} \\ \hline
    \hline
  \end{tabular}
  \caption{Tools used in the Classical B toolchain}
  \label{tab:classical-b-tools}
\end{table}
\end{center}

\section{Description of the approach for OpenETCS design process}

Taking into account the results presented in Section
\ref{sec:results}, the proposed toolchain completely covers both, the
system phase as well as the software phase (see
Fig. \ref{fig:results}). On system analysis level, SysML with Papyrus
would be used for modeling the SSRS. Also for the sub-system semi
formal model, which will be created during the sub-system formal
design phase, it is proposed to use SysML with Papyrus. The finished
models will then be transformed to B models, to perform further
development steps according to the B method.

For both, the sub-system strictly formal model and the software
semi-formal model it is proposed to use the B method. The development
of the B models will be done by further refining the read-only B
model, generated from the SysML model. It has to be investigated where
\emph{exactly} the transition between SysML and the B model will be
done. In particular, it is currently unclear which SysML language
constructs and diagrams will be used and transformed to B. The
structure described in SysML with \emph{Block Definition Diagrams
  (BDD)} and \emph{Internal Block Diagram (IBD)} are obviously prime
candidates for a transformation to B, but which behavior diagram can
and will can be transformed is still under investigation.

The last part of the development process, the code generation, is
performed with an existing code generator tool.

\section{Integration of the approach with SysML/Papyrus}

On the technical side, the integration will be performed by utilizing
the EMF framework of Eclipse. With an appropriate transformation
language (e.g. Xtend), the SysML model can be transformed to a textual
B model. If it is advantageous to perform the transformation with an
intermediate B meta-model and an a mode-to-model transformation (see
Fig. \ref{}) is under investigation.

The semantic integration of SysML and B method imposes a greater
challenge. There already exist literature regarding the alignment of
SysML and the B method. The work in \cite{} provides such an alignment
focusing on V\&V, which could be used as a base for further research,
which considers in particular the openETCS requirements.


\section{Integration of the approach with Eclipse}

The integration of the proposed toolchain is mainly done as described
in the previous section. After using SysML, the used tool is changed
to Atelier B. This obviously does not correspond to a fully Eclipse
based toolchain. However, this proposal only reflects an initial
toolchain, which could be improved during the project and beyond. The
parts of the toolchain which are user visible and in the first version
realized by Atelier B, could be progressively moved to an Eclipse
based solution. To what extend components from existing solutions
(e.g. the Rodin platform) can be used and if there are enough
resources in the project available, has to be investigated.

\section{Benefits versus OpenETCS requirements}

Both, SysML and the B Methods are accepted in the industry and have
been successful used in the development of safety critical embedded
systems. The B Method was used in Projects like KVB by Alstom, SAET
METEOR or in the driverless metro line 1 in Paris by Siemens
Transportaion Systems (see \ref{} for an extensive list).

Most parts of the toolchain are already available and distributed
under an open source license. The transformation from SysML to B is
the only missing software artifact, that has to be developed for the
first version of the toolchain (see
Fig. \ref{fig:classical-b-toolchain}).

The project consortium includes partner with great expertise in both
languages, SysML and B. By incorporating these expertise, there is a
good chance that the proclaimed goals of openETCS will be achieved.

The modular architecture allows the exchange of certain tools with
more powerful alternatives, even if they are closed-source. For
example, there is a closed source code generator which allows the
creation of ADA or C++ code. This code generator could be used as a
drop-in replacement for the open-source c4b if necessary.

Furthermore, with Eclipse and Atelier-B versions for Windows, Mac OS
and Linux, the most common operating systems are supported by the
proposed toolchain.

\section{Shortcommings versus OpenETCS requirements}

Although the majority of tools used in the toolchain are open-source,
there is a small amount of tools which are closed source (see
Fig. \ref{fig:classical-b-toolchain}). During the project these parts
will be further investigated with the goal to be replaced by
open-source equivalents.

\begin{todo_comment}
Discuss the shortcommings in regards of OpenETCS requirements and expected results.
\end{todo_comment}

\section{On going work for openETCS project}

\begin{todo_comment}
Which are the elements to clarify, to specify or to develop, in order the approach suit the openETCS process ?

How can we evaluate and plan this work ?

which skills is needed ?
\end{todo_comment}

\begin{itemize}
\item Define a subset of SysML that can be transformed to Classical B
\item Specify the precise border between SysML and Classical B
\item Plan and develop the model transformation from SysML to Classical B
\item Develop checks to ensure the completeness of the SysML model
\item 
\end{itemize}

\section{Conclusion and other comments}
